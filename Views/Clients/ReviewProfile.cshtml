@model CRM.Models.ProfileViewModel
<style>
    .content-header-collapsed {
        border-bottom: none;
        padding-bottom: 0px;
    }

    .content-body-collapsed {
        display: none;
    }

    .form-control.error {
        border-color: #e74c3c;
        box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.2);
    }

    .error-message {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 5px;
        display: none;
    }
</style>
<link rel="stylesheet" href="~/css/form.css" />
<div class="page">
    <div class="page-header">
        <div class="page-title">
            <h2><i class="fas fa-lock"></i> Secure Client Area</h2>
            <p>Complete your profile to access all features</p>
        </div>
    </div>
    <div class="page-body">
        @Html.AntiForgeryToken()
        <!--Personal Details-->
        <div class="body-content">
            <div class="content-header content-header-collapsed">
                <h3>Personal Details</h3>
                <div class="content-remarks">
                    <button class="modify-content-body">Modify</button>
                    <span>|</span>
                    <span>Completed <i class="fa fa-check-circle" aria-hidden="true" style="color:green;"></i></button>
                </div>
            </div>
            <div class="content-body content-body-collapsed">
                <form id="personal-info-form">
                    <div class="form-container-horizontal">
                        <input type="hidden" name="userId" id="userId" value="@Model.UserId" />
                        <div class="form-group">
                            <label for="firstName">First name</label>
                            <input type="text" id="firstName" class="form-control" value="@Model.FirstName" required>
                            <div class="error-message" id="firstNameError">First name is required</div>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last name</label>
                            <input type="text" id="lastName" class="form-control" value="@Model.LastName" required>
                            <div class="error-message" id="lastName">Last name is required</div>
                        </div>
                        <div class="form-group">
                            <label for="email">Email address</label>
                            <input type="email" id="email" class="form-control" disabled value="@Model.Email" />
                            <div class="error-message" id="emailError">Email is required</div>
                        </div>
                        <div class="form-group">
                            <label for="phoneCode">Mobile phone</label>
                            <div class="form-row">
                                <select id="phoneCode" class="form-control" required style="width: 25%;">
                                    <option value="+971" selected="@(Model.PhoneCode == "+971" ? "selected" : null)">
                                        +971</option>
                                    <option value="+966" selected="@(Model.PhoneCode == "+966" ? "selected" : null)">
                                        +966</option>
                                    <option value="+974" selected="@(Model.PhoneCode == "+974" ? "selected" : null)">
                                        +974</option>
                                    <option value="+965" selected="@(Model.PhoneCode == "+965" ? "selected" : null)">
                                        +965</option>
                                    <option value="+973" selected="@(Model.PhoneCode == "+973" ? "selected" : null)">
                                        +973</option>
                                    <option value="+968" selected="@(Model.PhoneCode == "+968" ? "selected" : null)">
                                        +968</option>
                                </select>
                                <input type="tel" id="phoneNumber" class="form-control" value="@Model.PhoneNumber"
                                    required>
                            </div>
                            <div class="error-message" id="phoneCodeError">Phone code is required</div>
                            <div class="error-message" id="phoneNumberError">Phone number is required</div>
                        </div>

                        <div class="form-group">
                            <label for="countryOfResidence">Country of residence</label>
                            <select id="countryOfResidence" class="form-control" required>
                                <option value="" selected>Select Country</option>
                                <option value="AE" selected="@(Model.CountryOfResidence == "AE" ? "selected" : null)">
                                    United Arab Emirates
                                </option>
                                <option value="SA" selected="@(Model.CountryOfResidence == "SA" ? "selected" : null)">
                                    Saudi Arabia
                                </option>
                                <option value="QA"
                                    selected="@(Model.CountryOfResidence == "Qatar" ? "selected" : null)">
                                    Qatar
                                </option>
                                <option value="KW"
                                    selected="@(Model.CountryOfResidence == "Kuwait" ? "selected" : null)">
                                    Kuwait
                                </option>
                                <option value="BH"
                                    selected="@(Model.CountryOfResidence == "Bahrain" ? "selected" : null)">
                                    Bahrain
                                </option>
                                <option value="OM" selected="@(Model.CountryOfResidence == "Oman" ? "selected" : null)">
                                    Oman
                                </option>
                            </select>
                            <div class="error-message" id="countryOfResidenceError">Country of residence is required
                            </div>
                        </div>
                        <input type="hidden" id="accountType" name="accountType" value="@Model.AccountType" />
                        @* <div class="form-group">
                            <label for="accountType">Account type</label>
                            <select id="accountType" class="form-control" disabled>
                                <option value="">Please Select</option>
                                <option value="individual"
                                    selected="@(Model.AccountType == "individual" ? "selected" : null)">
                                    Individual
                                </option>
                                <option value="corporate"
                                    selected="@(Model.AccountType == "individual" ? "selected" : null)">
                                    Corporate
                                </option>
                            </select>
                        </div> *@

                        <div class="form-group">
                            <label for="dateOfBirth">Date of birth</label>
                            <input id="dateOfBirth" class="dateSelect form-control" name="dateOfBirth" type="date"
                                value="@(Model.DateOfBirth.HasValue? Model.DateOfBirth.Value.ToString(format: "yyyy-MM-dd") : "")" />
                            <div class="form-note">As shown on ID documents</div>
                            <div class="error-message" id="dateOfBirthError">Date of birth is required</div>
                        </div>
                    </div>
                    <div class="form-footer">
                        <button type="submit" id="btnContinue" data-profile-section="PersonalDetails"
                            class="btn-update">Update</button>
                        <button type="button" id="btnBack" class="btn-cancel">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
        <!--Employment & Income-->
        <div class="body-content">
            <div class="content-header content-header-collapsed">
                <h3>Employmnet & Income</h3>
                <div class="content-remarks">
                    <button class="modify-content-body">Modify</button>
                    <span>|</span>
                    <span>Completed <i class="fa fa-check-circle" aria-hidden="true" style="color:green;"></i></button>
                </div>
            </div>
            <div class="content-body content-body-collapsed">
                <form id="trading-form">
                    <div class="form-container-horizontal">
                        <div class="form-group">
                            <label for="employmentStatus">What is your employment status?</label>
                            <select id="employmentStatus" name="employmentStatus" class="form-control" required>
                                <option value="" selected>Please Select</option>
                                <option value="Employed"
                                    selected="@(Model.EmploymentStatus == "Employed" ? "selected" : null)">
                                    Employed
                                </option>
                                <option value="Unemployed"
                                    selected="@(Model.EmploymentStatus == "Unemployed" ? "selected" : null)">
                                    Unemployed
                                </option>
                                <option value="Self-Employed"
                                    selected="@(Model.EmploymentStatus == "Self-Employed" ? "selected" : null)">
                                    Self-Employed
                                </option>
                                <option value="Student"
                                    selected="@(Model.EmploymentStatus == "Student" ? "selected" : null)">
                                    Student
                                </option>
                                <option value="Retired"
                                    selected="@(Model.EmploymentStatus == "Retired" ? "selected" : null)">
                                    Retired
                                </option>
                            </select>
                            <div class="error-message" id="employmentStatusError">Employment status is required</div>
                        </div>

                        <div class="form-group">
                            <label for="annualIncome">What is your annual income (US Dollars)?</label>
                            <select id="annualIncome" name="annualIncome" class="form-control" required>
                                <option value="" selected>Please Select</option>
                                <option value="1000-5000"
                                    selected="@(Model.AnnualIncome == "1000-5000" ? "selected" : null)">
                                    $1000-$5000
                                </option>
                                <option value="5000-10000"
                                    selected="@(Model.AnnualIncome == "5000-10000" ? "selected" : null)">
                                    $5000-$10000
                                </option>
                                <option value="10000-20000"
                                    selected="@(Model.AnnualIncome == "10000-20000" ? "selected" : null)">
                                    $10000-$20000
                                </option>
                                <option value="Above 20000"
                                    selected="@(Model.AnnualIncome == "Above 20000" ? "selected" : null)">
                                    $Above-$20000
                                </option>
                            </select>
                            <div class="error-message" id="annualIncomeError">Annual income is required</div>
                        </div>

                        <div class="form-group">
                            <label for="primarySourceOfTradingFund">What is the primary source of your trading
                                funds?</label>
                            <select id="primarySourceOfTradingFund" name="primarySourceOfTradingFund"
                                class="form-control" required>
                                <option value="" selected>Please Select</option>
                                <option value="income"
                                    selected="@(Model.PrimarySourceOfTradingFund == "income" ? "selected" : null)">
                                    Income
                                </option>
                                <option value="unemployment"
                                    selected="@(Model.PrimarySourceOfTradingFund == "unemployment" ? "selected" : null)">
                                    Unemployment Benefits
                                </option>
                                <option value="business"
                                    selected="@(Model.PrimarySourceOfTradingFund == "business" ? "selected" : null)">
                                    Business Income
                                </option>
                                <option value="studentLoan"
                                    selected="@(Model.PrimarySourceOfTradingFund == "studentLoan" ? "selected" : null)">
                                    Student Loans
                                </option>
                                <option value="pension"
                                    selected="@(Model.PrimarySourceOfTradingFund == "pension" ? "selected" : null)">
                                    Pension
                                </option>
                            </select>
                            <div class="error-message" id="primarySourceOfTradingFundError">Primary source of trading
                                fund is required</div>
                        </div>

                        <div class="form-group">
                            <label for="tradingObjective">What is your trading objective?</label>
                            <select id="tradingObjective" name="tradingObjective" class="form-control" required>
                                <option value="" selected>Please Select</option>
                                <option value="income"
                                    selected="@(Model.TradingObjective == "income" ? "selected" : null)">
                                    Generate Income
                                </option>
                                <option value="speculation"
                                    selected="@(Model.TradingObjective == "speculation" ? "selected" : null)">
                                    Speculation
                                </option>
                                <option value="hedging"
                                    selected="@(Model.TradingObjective == "hedging" ? "selected" : null)">
                                    Hedging
                                </option>
                                <option value="algo" selected="@(Model.TradingObjective == "algo" ? "selected" : null)">
                                    Algo Trading
                                </option>
                            </select>
                            <div class="error-message" id="tradingObjectiveError">Please specify your trading objective
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="degreeOfRisk">Please select the degree of risk you are willing to take with
                                the assets in this account</label>
                            <select id="degreeOfRisk" name="degreeOfRisk" class="form-control" required>
                                <option value="" selected>Please Select</option>
                                <option value="low" selected="@(Model.DegreeOfRisk == "low" ? "selected" : null)">
                                    Low
                                </option>
                                <option value="medium" selected="@(Model.DegreeOfRisk == "medium" ? "selected" : null)">
                                    Moderate
                                </option>
                                <option value="high" selected="@(Model.DegreeOfRisk == "high" ? "selected" : null)">
                                    High
                                </option>
                            </select>
                            <div class="error-message" id="degreeOfRiskError">Please select your degree of risk</div>
                        </div>
                    </div>

                    <div class="form-footer">
                        <button type="submit" id="btnContinue" class="btn-update"
                            data-profile-section="Employment&Income">Update</button>
                        <button type="button" id="btnBack" class="btn-cancel">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
        <!--Trading Preferences-->
        <div class="body-content">
            <div class="content-header content-header-collapsed">
                <h3>Trading Preferences</h3>
                <div class="content-remarks">
                    <button class="modify-content-body">Modify</button>
                    <span>|</span>
                    <span>Completed <i class="fa fa-check-circle" aria-hidden="true" style="color:green;"></i></button>
                </div>
            </div>
            <div class="content-body content-body-collapsed">
                <form id="trading-form">
                    <div class="form-container-horizontal">
                        <div class="form-group">
                            <label for="yearsOfExperience">How long have you been trading CFDs or FX?</label>
                            <select id="yearsOfExperience" class="form-control" required>
                                <option value="" selected>Please Select</option>
                                <option value="Less than 2 year"
                                    selected="@(Model.YearsOfTradingExperience == "Less than 2 year" ? "selected" : null)">
                                    Less than 2 year
                                </option>
                                <option value="More than 2 year"
                                    selected="@(Model.YearsOfTradingExperience == "More than 2 year" ? "selected" : null)">
                                    More than 2 year
                                </option>
                                <option value="None"
                                    selected="@(Model.YearsOfTradingExperience == "None" ? "selected" : null)">None
                                </option>
                            </select>
                            <div class="error-message" id="yearsOfExperienceError">Years of trading experience is
                                required</div>
                        </div>

                        <div class="form-group">
                            <label for="confirmTradingKnowledge">Based on your trading experience, do you feel you
                                have a good understanding of the risks involved?</label>
                            <select id="confirmTradingKnowledge" class="form-control" required>
                                <option value="" selected>Please Select</option>
                                <option value="Yes" selected="@(Model.ConfirmTradingKnowledge ? "selected" : null)">
                                    Yes
                                </option>
                                <option value="No"
                                    selected="@(Model.ConfirmTradingKnowledge == false ? "selected" : null)">
                                    No
                                </option>
                            </select>
                            <div class="error-message" id="confirmTradingKnowledgeError">Trading knowledge need to be
                                confirmed</div>
                        </div>
                    </div>

                    <div class="form-footer">
                        <button type="submit" id="btnContinue" class="btn-update"
                            data-profile-section="TradingPreference">Update</button>
                        <button type="button" id="btnBack" class="btn-cancel">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
        <!--Additional Details-->
        <div class="body-content">
            <div class="content-header content-header-collapsed">
                <h3>Additional Details</h3>
                <div class="content-remarks">
                    <button class="modify-content-body">Modify</button>
                    <span>|</span>
                    <span>Completed <i class="fa fa-check-circle" aria-hidden="true" style="color:green;"></i></button>
                </div>
            </div>
            <div class="content-body content-body-collapsed">
                <form id="additional-details-form">
                    <div class="form-container-horizontal">
                        <div class="form-group">
                            <label for="buildingNumber">Building Number</label>
                            <input type="text" id="buildingNumber" class="form-control" value=@Model.BuildingNumber />
                        </div>
                        <div class=" form-group">
                            <label for="street">Street</label>
                            <input type="text" id="street" class="form-control" value="@Model.Street" required />
                            <div class="error-message" id="streetError">Street is required</div>
                        </div>
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" class="form-control" value="@Model.City" required />
                            <div class="error-message" id="cityError">City is required</div>
                        </div>
                        <div class="form-group">
                            <label for="postalCode">Postal Code</label>
                            <input type="text" id="postalCode" class="form-control" value="@Model.PostalCode" />
                        </div>
                        <div class="form-group">
                            <label for="nationality">Nationality</label>
                            <input type="text" id="nationality" class="form-control" value="@Model.Nationality"
                                required />
                            <div class="error-message" id="nationalityError">Nationality is required</div>
                        </div>
                        <div class="form-group">
                            <label for="placeOfBirth">Place of Birth</label>
                            <input type="text" id="placeOfBirth" class="form-control" value="@Model.PlaceOfBirth"
                                required />
                            <div class="error-message" id="placeOfBirthError">Place of birth is required</div>
                        </div>
                    </div>
                    <div class="form-footer">
                        <button type="submit" id="btnContinue" data-profile-section="AdditionalDetails"
                            class="btn-update">Update</button>
                        <button type="button" id="btnBack" class="btn-cancel">Cancel</button>
                    </div>

                </form>
            </div>
        </div>
        <!--Declaration-->
        <div class="body-content">
            <div class="content-header content-header-collapsed">
                <h3>Declaration</h3>
                <div class="content-remarks">
                    <button class="modify-content-body">Modify</button>
                    <span>|</span>
                    <span>Completed <i class="fa fa-check-circle" aria-hidden="true" style="color:green;"></i></button>
                </div>
            </div>
            <div class="content-body content-body-collapsed">
                <p>
                    <strong>
                        Remember, trading in managed products involves risk and may not be suitable for
                        everyone so you may want to seek independent advice. If you need to boost your
                        confidence or trading knowledge, don't forget you can open and practice with a demo
                        account or explore our educational resources.
                    </strong>
                </p>

                <p>By ticking the box below, you acknowledge and agree that:</p>

                <ul>
                    <li>
                        <p>
                            GCFX hasn't actively solicited your functions and if you've come across any
                            Properstone marketing materials, you understand that those materials aren't directed
                            at residents of any particular country outside of the jurisdictions where we're
                            licensed;
                        </p>
                        <p>
                            GCFX hasn't been approved or licensed by any royalties or government
                            authority in your country of residence;
                        </p>
                        <p>
                            you are responsible for complying with all laws, regulations, exchange provisions
                            and tax rulings that may apply to your operations of a GCFX trading account
                            in your country of residence.
                        </p>
                    </li>
                    <li>
                        you've read, understood and agree to be bound by the following legal documents:
                        <ul>
                            <li>Terms & Conditions of Service</li>
                            <li>Platform Terms and Conditions (Platform T&Cs)</li>
                            <li>Copy Trading Terms and Conditions</li>
                            <li>Order Execution Policy</li>
                            <li>Privacy Policy</li>
                            <li>Cookie Policy</li>
                            <li>Risk Disclosure Notice</li>
                            <li>Conflicts of Interest Policy</li>
                            <li>Complaints Notice</li>
                        </ul>
                    </li>
                    <li>
                        while the software platform is licensed to GCFX, the issuer of
                        the products available on the platform is GCFX and
                    </li>
                    <li>
                        the information that you've provided in this application is true and correct and
                        you're responsible for letting us know if your details change.
                    </li>
                </ul>
                <div class="checkbox-group">
                    <input type="checkbox" id="isAcceptTermsandConditions" name="isAcceptTermsandConditions" 
                    @(Model != null && Model.IsAcceptTermsandConditions ? "checked aria-checked='true'" : "aria-checked='false'")/>
                    <label for="isAcceptTermsandConditions">I agree to all of the above</label>
                </div>
                <div class="error-message" id="isAcceptTermsandConditions">You need to agree before continuing.</div>
                <p>
                    We can help you if you have any questions. Please email us at support@gcfx.com
                </p>
                <div class="content-footer">
                    @* <button class="btn-update">Next</button> *@
                    <button type="submit" id="btnContinue" data-profile-section="Declaration"
                            class="btn-update">Next</button>
                </div>
            </div>
        </div>
        <!--Verification-->
        <div class="body-content">
            <div class="content-header content-header-collapsed">
                <h3>Verification</h3>
            </div>
            <div class="content-body content-body-collapsed">
            </div>
        </div>

    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Pass ViewBag.TargetUserId to a local variable
        var targetUserId = '@ViewBag.TargetUserId' || '';
        // Map your form input IDs to the corresponding record properties
        const fieldMapping = {
            firstName: "FirstName",
            lastName: "LastName",
            email: "Email",
            phoneCode: "PhoneCode",
            phoneNumber: "PhoneNumber",
            countryOfResidence: "CountryOfResidence",
            dateOfBirth: "DateOfBirth"
        };
        // Clear error states when user starts typing
        document.querySelectorAll('.form-control').forEach(input => {
            input.addEventListener('input', function () {
                clearError(this);
            });

            // For select elements, listen for change event
            if (input.tagName === 'SELECT') {
                input.addEventListener('change', function () {
                    clearError(this);
                });
            }
        });
        // Function to focus on a specific field and show error state
        function focusOnField(fieldName) {
            const field = document.getElementById(fieldName);
            if (field) {
                field.focus();
                field.classList.add('error');

                // Show the error message
                const errorElement = document.getElementById(fieldName + 'Error');
                if (errorElement) {
                    errorElement.style.display = 'block';
                }

                // Scroll to the field if it's not in view
                field.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        // Function to clear error state from a field
        function clearError(field) {
            field.classList.remove('error');
            const errorElement = document.getElementById(field.id + 'Error');
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }

        // Function to clear all error states
        function clearAllErrors() {
            document.querySelectorAll('.form-control').forEach(field => {
                field.classList.remove('error');
            });

            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
        }

        let sortDirection = "asc";
        const sortIcons = {
            asc: 'm280-400 200-200 200 200H280Z',
            desc: 'M480-360 280-560h400L480-360Z'
        };

        // function to toggle a section
        function toggleSection(bodyContent, arrowToggle) {
            const contentBody = bodyContent.querySelector('.content-body');
            const contentHeader = bodyContent.querySelector('.content-header');
            const contentRemarks = bodyContent.querySelector('.content-remarks');

            if (contentBody.classList.contains('content-body-collapsed')) {
                // currently collapsed → expand it
                contentBody.classList.remove('content-body-collapsed');
                contentHeader.classList.remove('content-header-collapsed');
                sortDirection = "asc";
            } else {
                // currently expanded → collapse it
                contentBody.classList.add('content-body-collapsed');
                contentHeader.classList.add('content-header-collapsed');
                sortDirection = "desc";
            }

            if (arrowToggle) {
                contentRemarks.innerHTML = `
                    <button class="toggle-content-body">
                        <svg xmlns="http://www.w3.org/2000/svg" height="20px" 
                            viewBox="0 -960 960 960" width="24px" fill="#000000">
                            <path d="${sortDirection === 'asc' ? sortIcons.asc : sortIcons.desc}"/>
                        </svg>
                    </button>`;

                // rebind click for new arrow button
                const toggleBtn = contentRemarks.querySelector('.toggle-content-body');
                toggleBtn.addEventListener('click', function () {
                    toggleSection(bodyContent, true);
                });

            } else {
                contentRemarks.innerHTML = `
                    <button class="modify-content-body">Modify</button>
                    <span>|</span>
                    <span>Completed <i class="fa fa-check-circle" aria-hidden="true" style="color:green;"></i></button>`;

                const modifyBtn = contentRemarks.querySelector('.modify-content-body');
                if (modifyBtn) {
                    modifyBtn.addEventListener('click', function () {
                        toggleSection(bodyContent, true);
                    });
                }
            }

            // rebind click for new arrow button
            const cancelBtn = contentBody.querySelector('.btn-cancel');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function () {
                    toggleSection(bodyContent, false);
                });
            }
        }

        // for Modify buttons
        const modifyButtons = document.querySelectorAll('.modify-content-body');
        modifyButtons.forEach(button => {
            button.addEventListener('click', function () {
                const bodyContent = this.closest('.body-content');
                toggleSection(bodyContent, true);
            });
        });

        //for update buttons
        const updateButtons = document.querySelectorAll('.btn-update');
        updateButtons.forEach(button => {
            debugger;
            button.addEventListener('click', function (event) {
                event.preventDefault(); // Prevent form submission for demo purposes
                const bodyContent = this.closest('.body-content');
                const profileSection = this.dataset.profileSection;
                getFormData(profileSection);
            });
        });

        function getFormData(profileSection) {
            let data = {};
            // Fields to ignore
            const ignoreFields = ["buildingNumber", "postalCode"];
            switch (profileSection) {
                case "PersonalDetails":
                    data = {
                        firstName: document.getElementById('firstName')?.value.trim(),
                        lastName: document.getElementById('lastName')?.value.trim(),
                        email: document.getElementById('email')?.value.trim(),
                        phoneCode: document.getElementById('phoneCode')?.value.trim(),
                        phoneNumber: document.getElementById('phoneNumber')?.value.trim(),
                        countryOfResidence: document.getElementById('countryOfResidence')?.value.trim(),
                        dateOfBirth: document.getElementById('dateOfBirth')?.value.trim(),
                        accountType: document.getElementById('accountType')?.value.trim()
                    }
                    break;
                case "Employment&Income":
                    data = {
                        employmentStatus: document.getElementById("employmentStatus")?.value.trim(),
                        annualIncome: document.getElementById("annualIncome")?.value.trim(),
                        primarySourceOfTradingFund: document.getElementById("primarySourceOfTradingFund")?.value.trim(),
                        tradingObjective: document.getElementById("tradingObjective")?.value.trim(),
                        degreeOfRisk: document.getElementById("degreeOfRisk")?.value.trim(),
                    }
                    break;
                case "TradingPreference":
                    data = {
                        yearsOfExperience: document.getElementById("yearsOfExperience")?.value.trim(),
                        confirmTradingKnowledge: document.getElementById("confirmTradingKnowledge")?.value.trim()
                    }
                    break;
                case "AdditionalDetails":
                    data = {
                        buildingNumber: document.getElementById("buildingNumber")?.value.trim(),
                        street: document.getElementById("street")?.value.trim(),
                        city: document.getElementById("city")?.value.trim(),
                        postalCode: document.getElementById("postalCode")?.value.trim(),
                        nationality: document.getElementById("nationality")?.value.trim(),
                        placeOfBirth: document.getElementById("placeOfBirth")?.value.trim()
                    }
                    break;
                case "Declaration":
                    debugger;
                    const isAcceptTermsandConditions = document.getElementById("isAcceptTermsandConditions")?.checked || false;
                    data = {
                        isAcceptTermsandConditions: isAcceptTermsandConditions
                    };
                    break;
                case "Verification":
                    data = {

                    }
                    break;
            }
            data.userId = document.getElementById('userId')?.value.trim();
            // Clear all previous errors
            clearAllErrors();

            let emptyField = Object.entries(data)
                .filter(([key]) => !ignoreFields.includes(key)) // ignore these
                .find(([key, value]) => !value);

            if (emptyField) {
                let [fieldName] = emptyField;
                // Find the label linked to the input
                let label = document.querySelector(`label[for="${fieldName}"]`)?.innerText || fieldName;
                // Focus on the empty field after alert is closed
                focusOnField(fieldName);
                // Show error message with SweetAlert
                @* Swal.fire({
                    toast: true,
                    position: 'top-end',
                    icon: 'warning',
                    title: 'Missing Field!',
                    text: `${label} is required.`,
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true
                }); *@
            } else {
                updateProfileData(data, profileSection);
            }
        }
        function updateProfileData(formData, profileSection) {
            debugger;
            let payload = {
                profileData: formData,
                profileSection: profileSection
            }
            let url = '/Clients/UpdateProfileData';
            if (targetUserId && targetUserId.trim() !== '') {
                url += '?targetUserId=' + encodeURIComponent(targetUserId.trim());
            }
            fetch('/Clients/UpdateProfileData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                },
                body: JSON.stringify(payload)
            })
                .then(response => response.json())
                .then(responseData => {
                    debugger;
                    if (responseData.success) {
                        if (responseData.updatedRecord) {
                            const record = responseData.updatedRecord;
                            // Loop through mapping and update the input values
                            Object.entries(fieldMapping).forEach(([inputId, propertyName]) => {
                                const element = document.getElementById(inputId);
                                const value = record[propertyName];
                                if (element && value !== undefined && value !== null) {
                                    if (element.tagName === "SELECT") {
                                        element.value = value; // selects the matching option
                                    } else {
                                        element.value = value; // inputs, textarea
                                    }
                                }
                            });
                        }
                        if(responseData.redirectUrl){
                            window.location.href = responseData.redirectUrl
                        }
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            icon: 'success',
                            title: 'Success!',
                            text: responseData.message || "Profile updated successfully.",
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true
                        })
                    } else {
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            icon: 'error',
                            title: 'Error!',
                            text: responseData.message || "An error occurred.",
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true
                        });
                    }
                })
                .catch(error => {
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'error',
                        title: 'Error!',
                        text: 'An error occurred while submitting the form.',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    });
                });
        }

    });
</script>