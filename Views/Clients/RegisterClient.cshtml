<div class="page">
    <div>
        <div class="page-body">
            <div>
                <div class="container" style="padding: 0;">
                    <div class="header">
                        <h1> Let's create your profile</h1>
                        @* <p>Complete your registration to get started</p> *@
                    </div>

                    <form id="client-form">
                        @Html.AntiForgeryToken()
                        <div class="form-container">
                            <div class="form-group">
                                <label for="countryOfResidence">Country of residence</label>
                                <select id="countryOfResidence" class="form-control" required>
                                    <option value="" selected>Select Country</option>
                                    <option value="AE">United Arab Emirates</option>
                                    <option value="SA">Saudi Arabia</option>
                                    <option value="QA">Qatar</option>
                                    <option value="KW">Kuwait</option>
                                    <option value="BH">Bahrain</option>
                                    <option value="OM">Oman</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="accountType">Account type</label>
                                <select id="accountType" class="form-control" required>
                                    <option value="">Please Select</option>
                                    <option value="individual">Individual</option>
                                    <option value="corporate">Corporate</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">First name</label>
                                    <input type="text" id="firstName" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Last name</label>
                                    <input type="text" id="lastName" class="form-control" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="dob">Date of birth</label>
                                <div class="form-row">
                                    <select id="dobDay" class="form-control" required>
                                        <option value="">DD</option>
                                        <!-- Days 1-31 -->
                                        <script>
                                            for (let i = 1; i <= 31; i++) {
                                                document.write(`<option value="${i}">${i}</option>`);
                                            }
                                        </script>
                                    </select>
                                    <select id="dobMonth" class="form-control" required>
                                        <option value="">MM</option>
                                        <option value="1">January</option>
                                        <option value="2">February</option>
                                        <option value="3">March</option>
                                        <option value="4">April</option>
                                        <option value="5">May</option>
                                        <option value="6">June</option>
                                        <option value="7">July</option>
                                        <option value="8">August</option>
                                        <option value="9">September</option>
                                        <option value="10">October</option>
                                        <option value="11">November</option>
                                        <option value="12">December</option>
                                    </select>
                                    <select id="dobYear" class="form-control" required>
                                        <option value="">YYYY</option>
                                        <!-- Years from 1950 to current year - 18 -->
                                        <script>
                                            const currentYear = new Date().getFullYear();
                                            for (let i = currentYear - 18; i >= 1950; i--) {
                                                document.write(`<option value="${i}">${i}</option>`);
                                            }
                                        </script>
                                    </select>
                                </div>
                                <div class="form-note">As shown on ID documents</div>
                            </div>

                            <div class="form-group">
                                <label for="phone">Mobile phone</label>
                                <div class="form-row">
                                    <select id="phoneCode" class="form-control" required style="width: 20%;">
                                        <option value="+971">+971</option>
                                        <option value="+966">+966</option>
                                        <option value="+974">+974</option>
                                        <option value="+965">+965</option>
                                        <option value="+973">+973</option>
                                        <option value="+968">+968</option>
                                    </select>
                                    <input type="tel" id="phoneNumber" class="form-control" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="email">Email address</label>
                                <input type="email" id="email" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label for="password">Password</label>
                                <div class="password-container">
                                    <input type="password" id="password" class="form-control" required>
                                    <span class="toggle-password" id="togglePassword">
                                        <i class="fas fa-eye-slash"></i>
                                    </span>
                                </div>
                                <div class="form-note">Use 8+ characters with a mix of letters, numbers & symbols</div>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="marketingConsent">
                                <label for="marketingConsent">We'd like to keep you informed of educational trading
                                    materials, events, relevant products and services via email, phone, SMS and other
                                    messaging platforms. Tick here to ensure you won't miss these communications that
                                    are relevant to you</label>
                            </div>

                            <button type="submit" id="btnContinue" class="btn-submit">Continue <i
                                    class="fas fa-arrow-right"></i></button>

                            <div class="login-link">
                                Already a client? <a href="#">Login here</a>.
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Password visibility toggle
        const togglePassword = document.getElementById('togglePassword');
        const password = document.getElementById('password');

        togglePassword.addEventListener('click', function () {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);

            // Toggle eye icon
            if (type === 'password') {
                this.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                this.innerHTML = '<i class="fas fa-eye"></i>';
            }
        });

        // Form validation and submission
        document.getElementById('client-form').addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent default form submission
            debugger;

            // Basic validation
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!firstName || !lastName || !email || !password) {
                alert('Please fill in all required fields');
                return;
            }

            // Email validation
            @* const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; *@
            @Html.Raw("const emailPattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;")
            if (!emailPattern.test(email)) {
                alert('Please enter a valid email address');
                return;
            }

            // Password strength validation
            if (password.length < 8) {
                alert('Password must be at least 8 characters long');
                return;
            }

            const formData = {
                countryOfResidence: document.getElementById('countryOfResidence').value,
                accountType: document.getElementById('accountType').value,
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                dobDay: document.getElementById('dobDay').value,
                dobMonth: document.getElementById('dobMonth').value,
                dobYear: document.getElementById('dobYear').value,
                phoneCode: document.getElementById('phoneCode').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                marketingConsent: document.getElementById('marketingConsent').checked
            };


            fetch('/Clients/SaveBasicInfo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                },
                body: JSON.stringify(formData)
            })
                .then(response => response.json())
                .then(responseData => {
                    if (responseData.success) {
                        console.log("Registration successful");
                        debugger;
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            icon: 'success',
                            title: 'Success!',
                            text: responseData.message || "Registration successful.",
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true
                        })
                        window.location.href = responseData.redirectUrl || '/Register/EmploymentInfo';
                    } else {
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            icon: 'error',
                            title: 'Error!',
                            text: responseData.message || "An error occurred.",
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true
                        });
                    }
                })
                .catch(error => {
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'error',
                        title: 'Error!',
                        text: 'An error occurred while submitting the form.',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true
                    });
                });
        });
    });
</script>